<!DOCTYPE html> <html lang="EN"> <head> <meta charset="utf-8"> <title>Deeds</title> <style>html body{margin:0 auto 0 auto;padding:20px;max-width:1024px;font-family:sans-serif;font-size:14pt;overflow-y:scroll;}html body a{text-decoration:none;}html body a[href]{color:#0055AA;}html body a[href]:hover{color:#0088EE;}html body pre{background:#FAFAFA;border:1px solid #DDDDDD;padding:0.75em;overflow-x:auto;}html body pre >code a[href]{color:#223388;}article.project h1{font-size:1.7em;}article.project h1,article.project h2,article.project h3,article.project h4,article.project h5,article.project h6{margin:0.2em 0 0.1em 0;text-indent:1em;}article.project >header{text-align:center;}article.project >header img.logo{display:block;margin:auto;max-height:170px;}article.project >header h1{display:inline-block;text-indent:0;font-size:2.5em;}article.project >header .version{vertical-align:bottom;}article.project >header .languages{margin-top:-0.5em;text-transform:capitalize;}article.project >header .description{margin:0;}article.project >header .pages{margin-top:0.5em;font-size:1.2em;text-transform:capitalize;}article.project >header .pages a{display:inline-block;padding:0 0.2em;}article.project >section{margin:1em 0 1em 0;}article.project >section img{max-width:100%;}article.project #index >ul{list-style:none;margin:0;padding:0;}article.project .row label{display:inline-block;min-width:8em;}article.project #system .row{display:flex;}article.project #system #dependencies{display:inline;margin:0;padding:0;}article.project #system #dependencies li{display:inline;padding:0 0.2em;}article.project #system #author label{vertical-align:top;}article.project #system #author ul{display:inline-block;margin:0;padding:0;list-style:none;}article.project #toc nav>*{margin-left:1em;display:block;}article.definition{margin:1em 0 0 0;}article.definition >header h1,article.definition >header h2,article.definition >header h3,article.definition >header h4,article.definition >header h5,article.definition >header h6{text-indent:0;display:inline-block;}article.definition >header ul{display:inline-block;list-style:none;margin:0;padding:0;}article.definition >header ul li{display:inline-block;padding:0 0.2em 0 0;}article.definition >header .visibility{display:none;}article.definition >header .visibility,article.definition >header .type{text-transform:lowercase;}article.definition >header .source-link{visibility:hidden;float:right;}article.definition >header .source-link:after{visibility:visible;content:"[SRC]";}article.definition .docstring{margin:0 0 0 1em;}article.definition .docstring pre{font-size:0.8em;white-space:pre-wrap;}.definition.package >header ul.nicknames{display:inline-block;list-style:none;margin:0;padding:0 0 0 1em;}.definition.package >header ul.nicknames li{display:inline;}.definition.package >header ul.nicknames:before{content:"(";}.definition.package >header ul.nicknames:after{content:")";}.definition.package ul.definitions{margin:0;list-style:none;padding:0 0 0 0.5em;}.definition.callable >header .name:before,.definition.type >header .name:before{content:"(";font-weight:normal;}.definition.callable >header .arguments:after,.definition.type >header .arguments:after{content:")";}.definition.callable >header .arguments .arguments:before,.definition.type >header .arguments .arguments:before{content:"(";}.definition.callable >header .arguments .argument,.definition.type >header .arguments .argument{padding:0;}.definition.callable >header .arguments .argument.lambda-list-keyword,.definition.type >header .arguments .argument.lambda-list-keyword{color:#991155;}.definition li>mark{background:none;border-left:0.3em solid #0088EE;padding-left:0.3em;display:block;}@media (min-width: 1300px){html body{padding-left:16em;}article.project #toc{margin:0;position:fixed;left:0;top:0;bottom:0;width:15em;overflow-y:auto;background:#F0F0F0;border-right:1px solid #A0A0A0;}}</style> </head> <body> <article class="project"> <header>   <h1>deeds</h1>   <span class="version">1.1.1</span>    <p class="description">Deeds Extensible Event Delivery System</p>   </header> <section id="toc"> <h2>Table of Contents</h2> <nav> <a href="#project">Top</a>  <a href="#documentation">Documentation</a> <nav> <a href="#about_deeds">About Deeds</a>  <a href="#how_to">How To</a>  <a href="#internals">Internals</a>  <a href="#events">Events</a>  <a href="#handlers">Handlers</a>  <a href="#event_loops">Event Loops</a> </nav>  <a href="#system">System</a>  <a href="#system">Packages</a> <nav> <a href="#PACKAGE%20DEEDS">DEEDS</a> </nav>  </nav> </section>  <section id="documentation"><h2 id="about_deeds">About Deeds</h2> <p>Deeds is an Extensible Event Delivery System. It allows for efficient event delivery to multiple handlers with a complex event filtering system.</p> <p>There are three main components to this system: events, loops, and handlers. Events are certain kinds of messages or data payloads that are to be sent out and processed by other parts in the system. Loops handle the distribution of the events, and handlers then finally do the processing of an event.</p> <p>There can be multiple independent loops in any application and handlers can be registered on any number of loops simultaneously. However, each event should only be sent out once and only on one loop. If it is necessary to issue an event multiple times or onto multiple loops, it needs to be copied.</p> <p>The distribution to handlers from the loop follows a strict ordering scheme that is specified on the handlers. Each handler can dictate a list of <code><a href="#GENERIC-FUNCTION%20DEEDS%3ABEFORE" class="xref">before</a></code> and <code><a href="#GENERIC-FUNCTION%20DEEDS%3AAFTER" class="xref">after</a></code> elements that precisely lay out their position in the issuing sequence. Additionally, handlers can specify a filter and event class that limit the type and kind of events that it will receive.</p> <p>The loop compiles an efficient, tailored function to issue events to handlers and perform the filtering. This means that even with a significant amount of handlers, issuing an event is still going to be very fast.</p> <p>Finally there are different types of handlers to give the user more control over the context in which the event handling happens and whether the loop should be blocked during the handler's execution.</p> <h2 id="how_to">How To</h2> <p>Load Deeds through Quicklisp or ASDF:</p> <pre><code>(ql:quickload :deeds)
</code></pre> <p>By default the system will set up and launch a standard event loop on <code><a href="#VARIABLE%20DEEDS%3A%2ASTANDARD-EVENT-LOOP%2A" class="xref">*standard-event-loop*</a></code>. You can then add handlers by using <code><a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-HANDLER" class="xref">define-handler</a></code>:</p> <pre><code>(deeds:define-handler (info-handler deeds:info-event) (event message)
  (format T &quot;~&amp;INFO: ~a~%&quot; message))

(deeds:define-handler (smiling-handler deeds:info-event) (event message)
  :filter '(search &quot;:)&quot; message)
  (format T &quot;~&amp;YAY: ~a~%&quot; message))
</code></pre> <p>Now let's issue some events and see what happens:</p> <pre><code><a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">(</a><a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE" class="xref">deeds:do-issue</a> deeds:info-event :message &quot;Hello!&quot;)
<a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">(</a><a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE" class="xref">deeds:do-issue</a> deeds:info-event :message &quot;Hey there :)&quot;)
<a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">(</a><a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE" class="xref">deeds:do-issue</a> deeds:warning-event :message &quot;Help! It's burning!&quot;)
</code></pre> <p>By default events have fields for the issue-time, the origin, and whether they've been cancelled. So let's play around with that.</p> <pre><code>(deeds:define-handler (simple-handler deeds:event) (event)
  (format T &quot;~&amp;Found event: ~a~%&quot; event))

(deeds:define-handler (pre-handler deeds:event) (event)
  :before '(:main)
  :class 'deeds:locally-blocking-handler
  (deeds:cancel event)
  (format T &quot;~&amp;Cancelling!~%&quot;))
</code></pre> <p>The first handler simply prints everything it finds. The second one is special in two ways: first it orders itself before every other normal handler by ordering itself before the main category. Second, it uses a different handler class. The default class is the <code><a href="#CLASS%20DEEDS%3AQUEUED-HANDLER" class="xref">queued-handler</a></code> which uses a singular queue in a different thread to process events. This handler on the other hand will not use any threads and instead run directly in the event loop, thus locally blocking it until the handler is done. This allows us to make sure that the event gets cancelled before it reaches anything else:</p> <pre><code><a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">(</a><a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE" class="xref">deeds:do-issue</a> deeds:event)
</code></pre> <p>As you can see, only the pre-handler is called. If you want to try it out, remove the <code><a href="#GENERIC-FUNCTION%20DEEDS%3ACANCEL" class="xref">cancel</a></code> call and recompile the pre-handler. Then the event should reach both handlers again. Alternatively you can add the <code>:handle-cancelled T</code> option to the simple-handler to override the default behaviour.</p> <h2 id="internals">Internals</h2> <p>This section documents how the particular standard implementation of the various components works. Some to all of this can be changed by subclassing the existing implementations and overriding the behaviour to suit your needs.</p> <h3 id="events">Events</h3> <p>In order to allow for any form of optimisation on the event filtering in the event loop, we need to enforce restrictions on what can happen to an event. The most straightforward restriction is to require immutability of the event slots. However, in some cases it is very much desirable to be able to mutate the slots -- as an example if you'd like to filter the text in a message event. As such, the most appropriate solution is to allow manual overriding of the immutability on a per-slot basis. To achieve this, a custom metaclass <code><a href="#CLASS%20DEEDS%3AEVENT-CLASS" class="xref">event-class</a></code> along with custom slot classes <code><a href="#CLASS%20DEEDS%3AEVENT-DIRECT-SLOT-DEFINITION" class="xref">event-direct-slot-definition</a></code> <code><a href="#CLASS%20DEEDS%3AEVENT-EFFECTIVE-SLOT-DEFINITION" class="xref">event-effective-slot-definition</a></code> have been created that tend to this behaviour.</p> <p>The slot classes have an additional field accessible through <code><a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-SLOT-MUTABLE" class="xref">event-slot-mutable</a></code> and specifiable through <code>:mutable</code>, which dictates whether the slot is mutable or not. If it is immutable but a writer has been specified on the slot anyway, an <code><a href="#CONDITION%20DEEDS%3AIMMUTABLE-EVENT-SLOT-HAS-WRITER" class="xref">immutable-event-slot-has-writer</a></code> warning is signalled upon class initialisation to warn the user of potentially dangerous behaviour. Similarly, if an attempt is made to actually perform a modification on an immutable slot during any time but the <code><a href="#CLASS%20DEEDS%3AEVENT" class="xref">event</a></code>'s <code><a href="#GENERIC-FUNCTION%20DEEDS%3AINITIALIZE-INSTANCE" class="xref">initialize-instance</a></code> time, a continuable error of type <code><a href="#CONDITION%20DEEDS%3AIMMUTABLE-EVENT-SLOT-MODIFIED" class="xref">immutable-event-slot-modified</a></code> is signalled. This way it is still possible to perform modifications on immutable slots if absolutely necessary, while the accidental case is prevented.</p> <p>In order to make defining events easier, a simple wrapper around <code><a href="#MACRO-FUNCTION%20DEEDS%3ADEFCLASS" class="xref">defclass</a></code> is provided called <code><a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-EVENT" class="xref">define-event</a></code>. A bunch of standard events are supplied to make the most common event actions easier: <code><a href="#CLASS%20DEEDS%3AMESSAGE-EVENT" class="xref">message-event</a></code>, <code><a href="#CLASS%20DEEDS%3AINFO-EVENT" class="xref">info-event</a></code>, <code><a href="#CLASS%20DEEDS%3AWARNING-EVENT" class="xref">warning-event</a></code>, <code><a href="#CLASS%20DEEDS%3AERROR-EVENT" class="xref">error-event</a></code>, <code><a href="#CLASS%20DEEDS%3APAYLOAD-EVENT" class="xref">payload-event</a></code>, <code><a href="#CLASS%20DEEDS%3ASEQUENCE-EVENT" class="xref">sequence-event</a></code>, <code><a href="#CLASS%20DEEDS%3ACHUNKED-PAYLOAD-EVENT" class="xref">chunked-payload-event</a></code>, <code><a href="#CLASS%20DEEDS%3AIDENTIFIED-EVENT" class="xref">identified-event</a></code>, <code><a href="#CLASS%20DEEDS%3ASTREAM-EVENT" class="xref">stream-event</a></code>, <code><a href="#CLASS%20DEEDS%3ASTREAM-BEGIN-EVENT" class="xref">stream-begin-event</a></code>, <code><a href="#CLASS%20DEEDS%3ASTREAM-PAYLOAD-EVENT" class="xref">stream-payload-event</a></code>, and <code><a href="#CLASS%20DEEDS%3ASTREAM-END-EVENT" class="xref">stream-end-event</a></code>.</p> <h3 id="handlers">Handlers</h3> <p>The primary distinguishing feature of a handler is the question of how it actually invokes the delivery function when an event is <code><a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">issue</a></code>d to the handler from a loop. The most primitive behaviour is to simply call the function directly. This is implemented by the <code><a href="#CLASS%20DEEDS%3ALOCALLY-BLOCKING-HANDLER" class="xref">locally-blocking-handler</a></code>, which in effect will block the issuing loop, but may still be invoked in parallel if multiple loops are involved. The next idea is to spawn a new thread for each event that is issued. This behaviour is implemented by the <code><a href="#CLASS%20DEEDS%3APARALLEL-HANDLER" class="xref">parallel-handler</a></code>. However, spawning lots of threads will quickly lead to situations where the threads interleave, and as such it is important that the delivery function takes care to lock and synchronise, which can be taxing on the user. Thus the next idea is to queue events and handle them in a separate thread. This avoids most contention and thrashing issues while still getting the benefit of unblocking the loop. This behaviour is implemented by the <code><a href="#CLASS%20DEEDS%3AQUEUED-HANDLER" class="xref">queued-handler</a></code>. Finally there is a variant of the <code><a href="#CLASS%20DEEDS%3ALOCALLY-BLOCKING-HANDLER" class="xref">locally-blocking-handler</a></code> that blocks all loops that have issued an event until their respective event is done. This is implemented by the <code><a href="#CLASS%20DEEDS%3AGLOBALLY-BLOCKING-HANDLER" class="xref">globally-blocking-handler</a></code>.</p> <p>Potentially much more complicated schemes that act differently depending on the issuing loop or the event to be processed could be conceived, but such things are too tied to the actual use-case at hand, and as such are left up to the user to implement. Writing such a handler should not prove very difficult, it is merely a matter of subclassing <code><a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">handler</a></code> and implementing the appropriate behaviour in <code><a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">issue</a></code> and <code><a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE" class="xref">handle</a></code>. The handler can then be used by supplying it to <code><a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-HANDLER" class="xref">define-handler</a></code> by the <code>:class</code> option.</p> <h3 id="event_loops">Event Loops</h3> <p>Finally the most complicated piece of machinery is the event loop itself. In order to understand the workings, first the lifecycle of an event must be analysed. From a user's perspective this would go as follows: an event instance is created and issued onto a loop. It is then handled by the appropriate handlers in the order as specified by their dependency restrictions. The most primitive way to handle this would be to build a dependency graph of the handlers and traverse them in their topological order, only invoking them when their filter applies to the event.</p> <p>However, this can become severely limiting when the amount of events and handlers becomes significant. The first optimisation is to separate the loop out into a dedicated thread with an event queue that buffers events. This unblocks the issuing thread and ensures that nothing is held up waiting. The next obvious improvement is to cache the dependency graph walking by generating the proper order of handlers upon handler registration. Finally we can realise that the event handler filters will share a lot of common tests which can be potentially rather costly if repeated too often. It would be good if those could be cached and bundled together to avoid unnecessary retesting.</p> <p>The default implementation <code><a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">compiled-event-loop</a></code> in Deeds solves these in the following manner: the unblocking of the issuing thread is achieved through a queue and a background processing thread. The dependency graph is calculated through <a href="https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm">Tarjan's algorithm</a> and cached as a list. It is recalculated every time a new handler is registered by <code><a href="#GENERIC-FUNCTION%20DEEDS%3ASORT-HANDLERS" class="xref">sort-handlers</a></code>. Finally, to make the event loop efficient it is treated as a <code><a href="#FUNCTION%20DEEDS%3ACOMPILE" class="xref">compile</a></code>d function that is built dynamically whenever necessary through <code><a href="#GENERIC-FUNCTION%20DEEDS%3ABUILD-EVENT-LOOP" class="xref">build-event-loop</a></code>. The mechanism of this is rather complicated.</p> <p>First, in order to optimise and cache tests the loop is separated into three &quot;phases&quot;. The first phase establishes lexical bindings for all tests and performs the type tests on the event object. The second phase performs the actual tests on the event as extracted from the handlers' filters if they are applicable under the current event class. Finally, the handlers are called in their <code><a href="#GENERIC-FUNCTION%20DEEDS%3ASORTED-HANDLERS" class="xref">sorted-handlers</a></code> order if their filter passes. The bulk of this behaviour is done by <code><a href="#FUNCTION%20DEEDS%3AEXTRACT-TESTS" class="xref">extract-tests</a></code> which uses <code><a href="#FUNCTION%20DEEDS%3AFILTER-TESTS" class="xref">filter-tests</a></code> to extract all tests from a filter. Tests are simply compared through <code><a href="#FUNCTION%20DEEDS%3AEQUAL" class="xref">equal</a></code> to see if they are the &quot;same&quot;. This is a very conservative comparison as several types of tests would return the same result even if their forms are not <code><a href="#FUNCTION%20DEEDS%3AEQUAL" class="xref">equal</a></code> such as for commutative tests. <code><a href="#FUNCTION%20DEEDS%3ACOMPILE-TEST" class="xref">compile-test</a></code> is used to replace the variable references within a test with event slot accessors as discovered by <code><a href="#FUNCTION%20DEEDS%3ABUILD-FUZZY-SLOT-ACCESSOR" class="xref">build-fuzzy-slot-accessor</a></code>. Finally <code><a href="#FUNCTION%20DEEDS%3AREPLACE-TESTS" class="xref">replace-tests</a></code> is used to replace the tests in a filter with the corresponding variables that are outputted to cache the tests. This is then all packed together into a <code><a href="#MACRO-FUNCTION%20DEEDS%3ALAMBDA" class="xref">lambda</a></code> form that can then be <code><a href="#FUNCTION%20DEEDS%3ACOMPILE" class="xref">compile</a></code>d into a function object.</p> <p>The optimisations done here are not optimal however. For example, no effort is done to group <code><a href="#MACRO-FUNCTION%20DEEDS%3AWHEN" class="xref">when</a></code> forms together in the outputted form when possible. This could save on branching and repeat tests in the resulting form. Similarly, no effort is done to recognise whether the required type tests of the handlers are actually strictly necessary or could be weakened to allow further grouping and conflating of tests. There are potentially many more possible improvements that could be done to make the event loop function even tighter, however the algorithms necessary to achieve this would quickly explode in complexity. For now we settle on this rather primitive approach as being sufficient.</p> <p>However, you can of course extend the system on your own by subclassing <code><a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP" class="xref">event-loop</a></code>/<code><a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">sorted-event-loop</a></code>/<code><a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">compiled-event-loop</a></code> and implementing the proper methods such as <code><a href="#GENERIC-FUNCTION%20DEEDS%3ABUILD-EVENT-LOOP" class="xref">build-event-loop</a></code>, <code><a href="#GENERIC-FUNCTION%20DEEDS%3ASORT-HANDLERS" class="xref">sort-handlers</a></code>, <code><a href="#GENERIC-FUNCTION%20DEEDS%3AREGISTER-HANDLER" class="xref">register-handler</a></code>, and <code><a href="#GENERIC-FUNCTION%20DEEDS%3ADEREGISTER-HANDLER" class="xref">deregister-handler</a></code>.</p> </section>    <section id="system"> <h2>System Information</h2>  <div class="row"> <label for="version">Version:</label> <a id="version">1.1.1</a> </div>   <div class="row"> <label for="dependencies">Dependencies:</label> <ul id="dependencies"><li><a class="external">closer-mop</a></li><li><a class="external">bordeaux-threads</a></li><li><a class="external" href="https://Shinmera.github.io/lambda-fiddle/">lambda-fiddle</a></li><li><a class="external" href="https://Shinmera.github.io/form-fiddle/">form-fiddle</a></li></ul> </div>   <div class="row" id="author"> <label for="author">Author:</label> <a href="mailto:shinmera@tymoon.eu">Yukari Hafner</a> </div>   <div class="row"> <label for="license">License:</label> <a id="license" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/LICENSE">zlib</a> </div>   <div class="row"> <label for="homepage">Homepage:</label> <a id="homepage" href="https://Shinmera.github.io/deeds/">https://Shinmera.github.io/deeds/</a> </div>   <div class="row"> <label for="bug-tracker">Bug Tracker:</label> <a id="bug-tracker" href="https://github.com/Shinmera/deeds/issues">https://github.com/Shinmera/deeds/issues</a> </div>   <div class="row"> <label for="sources">Sources:</label> <a id="sources" href="https://github.com/Shinmera/deeds.git">https://github.com/Shinmera/deeds.git</a> </div>  </section>    <section id="index"> <h2>Definition Index</h2> <ul> <li> <article class="definition package" id="PACKAGE DEEDS"> <header> <h3> <a href="#PACKAGE%20DEEDS">DEEDS</a> </h3> <ul class="nicknames"> <li>ORG.SHIRAKUMO.DEEDS</li> </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> <ul class="definitions"> <li> <article class="definition special-variable" id="VARIABLE DEEDS:*ORIGIN*"> <header> <span class="visibility">EXTERNAL</span> <span class="type">SPECIAL-VARIABLE</span> <h4 class="name"> <a href="#VARIABLE%20DEEDS%3A%2AORIGIN%2A">*ORIGIN*</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/origin.lisp#L3">Source</a>  </header> <div class="docstring"><pre>The variable designating the current origin.

The value of this might not be useful or significant for anything,
but if at all possible it should denote some kind of identifier for
the place where an event was signalled from.

See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ORIGIN" class="xref">WITH-ORIGIN</a></pre></div> </article> </li>  <li> <article class="definition special-variable" id="VARIABLE DEEDS:*STANDARD-EVENT-LOOP*"> <header> <span class="visibility">EXTERNAL</span> <span class="type">SPECIAL-VARIABLE</span> <h4 class="name"> <a href="#VARIABLE%20DEEDS%3A%2ASTANDARD-EVENT-LOOP%2A">*STANDARD-EVENT-LOOP*</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L3">Source</a>  </header> <div class="docstring"><pre>The default global instance of a compiled-event-loop.</pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:BLOCKING-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ABLOCKING-EVENT">BLOCKING-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L3">Source</a>  </header> <div class="docstring"><pre>A blocking event.

This event blocks on all handlers it passes through and blocks the issuing
thread until it is done being handled. This behaviour is sometimes desired,
especially in cases where remote communication is involved and sequential
execution on the issuing side must be ensured. This order cannot be
guaranteed with standard events, as while the events are issued in order
and handled in order by the same handler, they might change order between
different handlers.

See <a href="#CLASS%20DEEDS%3AEVENT" class="xref">EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:CACHED-SLOTS-CLASS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ACACHED-SLOTS-CLASS">CACHED-SLOTS-CLASS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/class-slots.lisp#L3">Source</a>  </header> <div class="docstring"><pre>A metaclass that caches all the direct slot instances available to it.

The cache is renewed on re/initialization of the class.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ACLASS-ALL-DIRECT-SLOTS" class="xref">CLASS-ALL-DIRECT-SLOTS</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:CHUNKED-PAYLOAD-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ACHUNKED-PAYLOAD-EVENT">CHUNKED-PAYLOAD-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L32">Source</a>  </header> <div class="docstring"><pre>A payload delivery event for which the payload has been cut up into chunks.

See <a href="#CLASS%20DEEDS%3APAYLOAD-EVENT" class="xref">PAYLOAD-EVENT</a>
See <a href="#CLASS%20DEEDS%3ASEQUENCE-EVENT" class="xref">SEQUENCE-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:COMMAND-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ACOMMAND-EVENT">COMMAND-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/command.lisp#L3">Source</a>  </header> <div class="docstring"><pre>Event used for commands

See <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-COMMAND" class="xref">DEFINE-COMMAND</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:COMPILED-EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP">COMPILED-EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L198">Source</a>  </header> <div class="docstring"><pre>An optimised event loop that compiles the issuing function for fast delivery.

Implements a standard queued event loop that respects all other
constraints. Supports rudimentary optimisation of the event loop
handler filter tests to speed up delivery and generates a tight
event delivery function that should allow issuing events to
handlers very efficiently.

See <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">SORTED-EVENT-LOOP</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ABUILD-EVENT-LOOP" class="xref">BUILD-EVENT-LOOP</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ARECOMPILE-EVENT-LOOP" class="xref">RECOMPILE-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:CONDITION-NOTIFY-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ACONDITION-NOTIFY-HANDLER">CONDITION-NOTIFY-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L130">Source</a>  </header> <div class="docstring"><pre>Handler that notifies a condition variable once it receives its event.
Saves the received event in its slot.

See <a href="#CLASS%20DEEDS%3AONE-TIME-HANDLER" class="xref">ONE-TIME-HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ACONDITION-VARIABLE" class="xref">CONDITION-VARIABLE</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE-SYNCHRONIZER-LOCK" class="xref">ISSUE-SYNCHRONIZER-LOCK</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ARESPONSE-EVENT" class="xref">RESPONSE-EVENT</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-RESPONSE" class="xref">WITH-RESPONSE</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:ERROR-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AERROR-EVENT">ERROR-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L17">Source</a>  </header> <div class="docstring"><pre>Delivers an error message.

See <a href="#CLASS%20DEEDS%3AMESSAGE-EVENT" class="xref">MESSAGE-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT">EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event.lisp#L3">Source</a>  </header> <div class="docstring"><pre>Base class for all events.

Anything that would like to be processed by an event-delivery must
inherit from this class.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE-TIME" class="xref">ISSUE-TIME</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AORIGIN" class="xref">ORIGIN</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ACANCELLED" class="xref">CANCELLED</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-CLASS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-CLASS">EVENT-CLASS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-class.lisp#L3">Source</a>  </header> <div class="docstring"><pre>Metaclass for events.

Uses the EVENT-SLOT class for slots, to allow specification of im/mutable slots.

See <a href="#CLASS%20DEEDS%3AEVENT-SLOT" class="xref">EVENT-SLOT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-DELIVERY"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-DELIVERY">EVENT-DELIVERY</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L8">Source</a>  </header> <div class="docstring"><pre>A base class for any kind of object that can deliver events.

This class must implement START, STOP, ISSUE, and HANDLE.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ADELIVERY-FUNCTION" class="xref">DELIVERY-FUNCTION</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-DIRECT-SLOT-DEFINITION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-DIRECT-SLOT-DEFINITION">EVENT-DIRECT-SLOT-DEFINITION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-class.lisp#L22">Source</a>  </header> <div class="docstring"><pre>A standard-direct-slot-definition for an event-slot.</pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-EFFECTIVE-SLOT-DEFINITION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-EFFECTIVE-SLOT-DEFINITION">EVENT-EFFECTIVE-SLOT-DEFINITION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-class.lisp#L25">Source</a>  </header> <div class="docstring"><pre>A standard-effective-slot-definition for an event-slot.</pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-LOOP">EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L15">Source</a>  </header> <div class="docstring"><pre>The base class for an event loop.

This event loop is incredibly crude and should only serve as a basis
for either very specific scenarios or to build a new event-loop on
top of it. It does not sort the handlers properly nor optimise the
delivery in any way but simply tests and calls each handler in
whatever order it might find them in at the moment.

On the other hand, de/registering handlers will be very cheap on
this handler, as no recompilation or analysis is required.

See <a href="#CLASS%20DEEDS%3AQUEUED-EVENT-DELIVERY" class="xref">QUEUED-EVENT-DELIVERY</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLERS" class="xref">HANDLERS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-LOCK" class="xref">EVENT-LOOP-LOCK</a>
See <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">SORTED-EVENT-LOOP</a>
See <a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">COMPILED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:EVENT-SLOT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AEVENT-SLOT">EVENT-SLOT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-class.lisp#L18">Source</a>  </header> <div class="docstring"><pre>Base class for the event-slot classes.

Contains one extra field (:MUTABLE) that allows specification of
whether the slot is allowed to be mutated through a writer.
If the user attempts to specify a writer (or accessor) on the slot
while :MUTABLE NIL, a warning of type IMMUTABLE-EVENT-SLOT-HAS-WRITER
is signalled. If an attempt is made to write to a slot that has been
designated immutable, a continuable error of type IMMUTABLE-EVENT-SLOT-MODIFIED
is signalled. 

By default slots are immutable.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-SLOT-MUTABLE" class="xref">EVENT-SLOT-MUTABLE</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:GLOBALLY-BLOCKING-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AGLOBALLY-BLOCKING-HANDLER">GLOBALLY-BLOCKING-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L69">Source</a>  </header> <div class="docstring"><pre>A handler that globally blocks all issuing threads until it is done.

The difference to LOCALLY-BLOCKING-HANDLER is only apparent in the case
where multiple event loops issue to this same handler at the same time,
in which case both are blocked until their individual events are done
being processed.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-LOCK" class="xref">HANDLER-LOCK</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AHANDLER">HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L3">Source</a>  </header> <div class="docstring"><pre>Base class for all handlers to which events can be delivered.

In order for an event to be issued to this, the following criteria should
apply to the event. First, the event must pass the type test against the value
from the handler's EVENT-TYPE slot. Note that the event-type can be a compound
type. Second, the event must pass the handler's FILTER test as per TEST-FILTER.

See <a href="#CLASS%20DEEDS%3AEVENT-DELIVERY" class="xref">EVENT-DELIVERY</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ANAME" class="xref">NAME</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-TYPE" class="xref">EVENT-TYPE</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AFILTER" class="xref">FILTER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ABEFORE" class="xref">BEFORE</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AAFTER" class="xref">AFTER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE-CANCELLED" class="xref">HANDLE-CANCELLED</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:IDENTIFIED-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AIDENTIFIED-EVENT">IDENTIFIED-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L35">Source</a>  </header> <div class="docstring"><pre>An event that belongs to a certain identified group.

The identifier defaults to the event itself.

See <a href="#CLASS%20DEEDS%3AEVENT" class="xref">EVENT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AIDENTIFIER" class="xref">IDENTIFIER</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:INFO-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AINFO-EVENT">INFO-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L11">Source</a>  </header> <div class="docstring"><pre>Delivers an informational message.

See <a href="#CLASS%20DEEDS%3AMESSAGE-EVENT" class="xref">MESSAGE-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:LOCALLY-BLOCKING-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ALOCALLY-BLOCKING-HANDLER">LOCALLY-BLOCKING-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L66">Source</a>  </header> <div class="docstring"><pre>A handler that handles the event in the issuing thread and thus blocks it.

This is useful for handlers that need to modify the event they receive,
as then it is guaranteed that the modification is done before any further
handlers can be called with the event.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">HANDLER</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:MESSAGE-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AMESSAGE-EVENT">MESSAGE-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L6">Source</a>  </header> <div class="docstring"><pre>A simple event merely used to deliver message strings.

See <a href="#CLASS%20DEEDS%3AEVENT" class="xref">EVENT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AMESSAGE" class="xref">MESSAGE</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:ONE-TIME-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AONE-TIME-HANDLER">ONE-TIME-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L113">Source</a>  </header> <div class="docstring"><pre>A handler that can only be called until it is successful.

If the delivery-function of the handler returns a non-NIL result, the
handler immediately deregisters itself from all its loops and stops
itself, thus only ever handling one &quot;correct&quot; event.

The return test is done to allow the user more sophisticated testing
of the event than is possible through the filter mechanism.

See <a href="#CLASS%20DEEDS%3AQUEUED-HANDLER" class="xref">QUEUED-HANDLER</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ONE-TIME-HANDLER" class="xref">WITH-ONE-TIME-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:PARALLEL-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3APARALLEL-HANDLER">PARALLEL-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L28">Source</a>  </header> <div class="docstring"><pre>A handler that starts a new thread to handle each event that it receives through ISSUE.

Note that if you use this handler you must care for resource locking
yourself. This can potentially be very tricky and inefficient.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ATHREADS" class="xref">THREADS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-LOCK" class="xref">HANDLER-LOCK</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:PAYLOAD-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3APAYLOAD-EVENT">PAYLOAD-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L20">Source</a>  </header> <div class="docstring"><pre>A simple event used to deliver some kind of data payload.

See <a href="#CLASS%20DEEDS%3AEVENT" class="xref">EVENT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3APAYLOAD" class="xref">PAYLOAD</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:QUEUED-EVENT-DELIVERY"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AQUEUED-EVENT-DELIVERY">QUEUED-EVENT-DELIVERY</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L49">Source</a>  </header> <div class="docstring"><pre>An event delivery that uses a queue and background thread to deliver events.

See <a href="#CLASS%20DEEDS%3AEVENT-DELIVERY" class="xref">EVENT-DELIVERY</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:QUEUED-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AQUEUED-HANDLER">QUEUED-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L59">Source</a>  </header> <div class="docstring"><pre>A handler that uses an event queue and separate thread to process them.

This is the default handler class. Since there is only a single thread per
handler, resources on the handler itself should be safe to access. However,
you still have to tend after locking of external resources on your own as
they might be modified and accessed in any fashion.
Also note that since this is a single, queued handler that any event that
takes a very long time will block other events on the handler from being
processed. It will not however block the event-loop from which the events are
issued.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">HANDLER</a>
See <a href="#CLASS%20DEEDS%3AQUEUED-EVENT-DELIVERY" class="xref">QUEUED-EVENT-DELIVERY</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:SEQUENCE-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASEQUENCE-EVENT">SEQUENCE-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L25">Source</a>  </header> <div class="docstring"><pre>An event that is part of a sequence of events.

See <a href="#CLASS%20DEEDS%3AEVENT" class="xref">EVENT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AINDEX" class="xref">INDEX</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AMAX-INDEX" class="xref">MAX-INDEX</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:SORTED-EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP">SORTED-EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L134">Source</a>  </header> <div class="docstring"><pre>An event loop that respects the sorting order of handlers.

This event loop will always make sure the handlers are in proper
order to be called in, but does not perform any further optimisation.
As such, this handler should still be reasonably fast to de/register
handlers on, but will obviously suffer the deficiencies in issuing
due to the lack of optimisation.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP" class="xref">EVENT-LOOP</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ASORTED-HANDLERS" class="xref">SORTED-HANDLERS</a>
See <a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">COMPILED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:STREAM-BEGIN-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASTREAM-BEGIN-EVENT">STREAM-BEGIN-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L46">Source</a>  </header> <div class="docstring"><pre>Stream event to signal the beginning of a stream.

All further stream events that belong to this stream must have the
same identifier as this. Events belonging to this stream may appear
until a STREAM-END-EVENT has been issued belonging to this stream.

See <a href="#CLASS%20DEEDS%3ASTREAM-EVENT" class="xref">STREAM-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:STREAM-END-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASTREAM-END-EVENT">STREAM-END-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L54">Source</a>  </header> <div class="docstring"><pre>Stream event to signal the end of a stream.

See <a href="#CLASS%20DEEDS%3ASTREAM-EVENT" class="xref">STREAM-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:STREAM-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASTREAM-EVENT">STREAM-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L43">Source</a>  </header> <div class="docstring"><pre>Base event for stream events.

All stream events that belong to the same stream must have the same
identifier. Stream events are insignificant unless they are issued
after a STREAM-BEGIN-EVENT of the same identifier and before a
STREAM-END-EVENT of the same identifier.

See <a href="#CLASS%20DEEDS%3AIDENTIFIED-EVENT" class="xref">IDENTIFIED-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:STREAM-PAYLOAD-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3ASTREAM-PAYLOAD-EVENT">STREAM-PAYLOAD-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L49">Source</a>  </header> <div class="docstring"><pre>A payload event for a particular stream.

See <a href="#CLASS%20DEEDS%3APAYLOAD-EVENT" class="xref">PAYLOAD-EVENT</a>
See <a href="#CLASS%20DEEDS%3ASTREAM-EVENT" class="xref">STREAM-EVENT</a></pre></div> </article> </li>  <li> <article class="definition class" id="CLASS DEEDS:WARNING-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CLASS</span> <h4 class="name"> <a href="#CLASS%20DEEDS%3AWARNING-EVENT">WARNING-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/standard-events.lisp#L14">Source</a>  </header> <div class="docstring"><pre>Delivers a warning message.

See <a href="#CLASS%20DEEDS%3AMESSAGE-EVENT" class="xref">MESSAGE-EVENT</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:EVENT-CONDITION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AEVENT-CONDITION">EVENT-CONDITION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L18">Source</a>  </header> <div class="docstring"><pre>Condition base class for conditions related to events.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-EVENT" class="xref">EVENT-CONDITION-EVENT</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:EVENT-LOOP-CONDITION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AEVENT-LOOP-CONDITION">EVENT-LOOP-CONDITION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L33">Source</a>  </header> <div class="docstring"><pre>Condition base class for conditions related to event-loops.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-CONDITION-EVENT-LOOP" class="xref">EVENT-LOOP-CONDITION-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:EVENT-LOOP-HANDLER-DEPENDENCY-CYCLE-ERROR"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AEVENT-LOOP-HANDLER-DEPENDENCY-CYCLE-ERROR">EVENT-LOOP-HANDLER-DEPENDENCY-CYCLE-ERROR</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L36">Source</a>  </header> <div class="docstring"><pre>An error that is signalled whenever a dependency cycle is detected within the handlers.

See <a href="#CONDITION%20DEEDS%3AEVENT-LOOP-CONDITION" class="xref">EVENT-LOOP-CONDITION</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-CONDITION-HANDLER" class="xref">EVENT-LOOP-CONDITION-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:HANDLER-CONDITION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AHANDLER-CONDITION">HANDLER-CONDITION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L42">Source</a>  </header> <div class="docstring"><pre>Condition base class for conditions related to handlers.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-CONDITION-HANDLER" class="xref">HANDLER-CONDITION-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:HANDLER-THREAD-STOP-FAILED-WARNING"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AHANDLER-THREAD-STOP-FAILED-WARNING">HANDLER-THREAD-STOP-FAILED-WARNING</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L45">Source</a>  </header> <div class="docstring"><pre>A warning that is signalled whenever a thread of a handler fails to stop.

See <a href="#CONDITION%20DEEDS%3AHANDLER-CONDITION" class="xref">HANDLER-CONDITION</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-CONDITION-THREAD" class="xref">HANDLER-CONDITION-THREAD</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:IMMUTABLE-EVENT-SLOT-HAS-WRITER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AIMMUTABLE-EVENT-SLOT-HAS-WRITER">IMMUTABLE-EVENT-SLOT-HAS-WRITER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L27">Source</a>  </header> <div class="docstring"><pre>A warning that is signalled whenever an immutable slot is specified with a writer.

See <a href="#CONDITION%20DEEDS%3AEVENT-CONDITION" class="xref">EVENT-CONDITION</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-SLOT" class="xref">EVENT-CONDITION-SLOT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-WRITERS" class="xref">EVENT-CONDITION-WRITERS</a></pre></div> </article> </li>  <li> <article class="definition condition" id="CONDITION DEEDS:IMMUTABLE-EVENT-SLOT-MODIFIED"> <header> <span class="visibility">EXTERNAL</span> <span class="type">CONDITION</span> <h4 class="name"> <a href="#CONDITION%20DEEDS%3AIMMUTABLE-EVENT-SLOT-MODIFIED">IMMUTABLE-EVENT-SLOT-MODIFIED</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/forward-class-definitions.lisp#L21">Source</a>  </header> <div class="docstring"><pre>An error that is signalled whenever an attempt is made to modify an immutable slot.

See <a href="#CONDITION%20DEEDS%3AEVENT-CONDITION" class="xref">EVENT-CONDITION</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-SLOT" class="xref">EVENT-CONDITION-SLOT</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-VALUE" class="xref">EVENT-CONDITION-VALUE</a></pre></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION DEEDS:BROADCAST"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20DEEDS%3ABROADCAST">BROADCAST</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-TYPE</li>    <li class="argument lambda-list-keyword">&amp;REST</li>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;KEY</li>    <li class="argument">LOOP</li>    <li class="argument lambda-list-keyword">&amp;ALLOW-OTHER-KEYS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L129">Source</a>  </header> <div class="docstring"><pre>Shorthand function to allow issuing of an event to multiple loops.

Supports an extra keyword argument that will not be passed along
to the MAKE-INSTANCE call: LOOP will instead denote the event-loop/s
to which one instance each will be issued, defaulting to
*STANDARD-EVENT-LOOP*.

See <a href="#VARIABLE%20DEEDS%3A%2ASTANDARD-EVENT-LOOP%2A" class="xref">*STANDARD-EVENT-LOOP*</a></pre></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION DEEDS:COMPUTE-ALL-DIRECT-SLOTS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20DEEDS%3ACOMPUTE-ALL-DIRECT-SLOTS">COMPUTE-ALL-DIRECT-SLOTS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CLASS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/class-slots.lisp#L33">Source</a>  </header> <div class="docstring"><pre>Computes all direct slots of the given class, including those of its superclasses.

This simply traverses the class hierarchy upwards, gathering all
direct-slots instances along the way. If one class along the way
is a CACHED-SLOTS-CLASS, the CLASS-ALL-DIRECT-SLOTS value is used
directly instead of traversing further. This does not apply for
the passed class.

See <a href="#CLASS%20DEEDS%3ACACHED-SLOTS-CLASS" class="xref">CACHED-SLOTS-CLASS</a></pre></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION DEEDS:MAKE-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20DEEDS%3AMAKE-HANDLER">MAKE-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument lambda-list-keyword">&amp;REST</li>    <li class="argument">OPTIONS</li>    <li class="argument lambda-list-keyword">&amp;KEY</li>    <li class="argument">LOOP</li>    <li class="argument">CLASS</li>    <li class="argument lambda-list-keyword">&amp;ALLOW-OTHER-KEYS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L76">Source</a>  </header> <div class="docstring"><pre>Creates a new handler instance and takes care of registering it.

Creating a new handler this way will simply construct the handler object,
start it, and register it on the event loop. If a handler with the same
name already exists on the event loop, this old handler is stopped and
replaced by the new one.

Only the :LOOP and :CLASS options are not passed along to the
make-instance call, as they are used by make-handler itself.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER" class="xref">HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AREGISTER-HANDLER" class="xref">REGISTER-HANDLER</a>
See <a href="#CLASS%20DEEDS%3AQUEUED-HANDLER" class="xref">QUEUED-HANDLER</a>
See <a href="#VARIABLE%20DEEDS%3A%2ASTANDARD-EVENT-LOOP%2A" class="xref">*STANDARD-EVENT-LOOP*</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-HANDLER" class="xref">WITH-HANDLER</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-HANDLER" class="xref">DEFINE-HANDLER</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ONE-TIME-HANDLER" class="xref">WITH-ONE-TIME-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition function callable" id="FUNCTION DEEDS:TEST-FILTER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">FUNCTION</span> <h4 class="name"> <a href="#FUNCTION%20DEEDS%3ATEST-FILTER">TEST-FILTER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">FILTER</li>    <li class="argument">EVENT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L80">Source</a>  </header> <div class="docstring"><pre>Test the filter against the event.

Note that you must test whether the event is of applicable type as
required by the test yourself, since the test form does not contain
this information in itself.

The structure of a filter is as follows:

FILTER     ::= COMBINATOR | TEST
COMBINATOR ::= (AND TEST*) | (OR TEST*) | (NOT TEST)
TEST       ::= (function ARGUMENT*)
ARGUMENT   ::= fuzzy-slot-symbol | atom

fuzzy-slot-symbols denote the value of a slot on the event object.
The actual slot is figured out per FIND-CLASS-SLOT-FUZZY on the
EVENT-TYPE of the handler.

See <a href="#FUNCTION%20DEEDS%3AFIND-CLASS-SLOT-FUZZY" class="xref">FIND-CLASS-SLOT-FUZZY</a>

See <a href="#GENERIC-FUNCTION%20DEEDS%3AFILTER" class="xref">FILTER</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:AFTER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AAFTER">AFTER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>A list of handler names or categories after which this handler should be called.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:BEFORE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ABEFORE">BEFORE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>A list of handler names or categories before which this handler should be called.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:BUILD-EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ABUILD-EVENT-LOOP">BUILD-EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLERS</li>    <li class="argument">COMPILED-EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L12">Source</a>  </header> <div class="docstring"><pre>Build a lambda form for the event loop delivery function.

The handlers must be in the properly sorted order as returned by
SORT-HANDLERS on the same EVENT-LOOP object as is used to call
this function.

See <a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">COMPILED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:CANCEL"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ACANCEL">CANCEL</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event.lisp#L31">Source</a>  </header> <div class="docstring"><pre>Cancels the event.

An event can be cancelled multiple times though the effect does not change.
Once an event has been cancelled it can only be handled by handlers that
have HANDLE-CANCELLED set to a non-NIL value.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ACANCELLED" class="xref">CANCELLED</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE-CANCELLED" class="xref">HANDLE-CANCELLED</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:CANCELLED"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ACANCELLED">CANCELLED</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Accessor to whether the event has been cancelled.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ACANCEL" class="xref">CANCEL</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF CANCELLED)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20CANCELLED%29">(SETF CANCELLED)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:CLASS-ALL-DIRECT-SLOTS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ACLASS-ALL-DIRECT-SLOTS">CLASS-ALL-DIRECT-SLOTS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Finds all direct-slot instances that this class will inherit.

More explicitly, it traverses the superclass tree and gathers all direct-slots it can find.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF CLASS-ALL-DIRECT-SLOTS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20CLASS-ALL-DIRECT-SLOTS%29">(SETF CLASS-ALL-DIRECT-SLOTS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:DELIVER-EVENT-DIRECTLY"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ADELIVER-EVENT-DIRECTLY">DELIVER-EVENT-DIRECTLY</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT</li>    <li class="argument">EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L9">Source</a>  </header> <div class="docstring"><pre>Performs a primitive, direct delivery of the event on the loop.

This means that handler filters are tested directly without any
possible room for optimisation.

See <a href="#FUNCTION%20DEEDS%3ATEST-FILTER" class="xref">TEST-FILTER</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:DELIVERY-FUNCTION"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ADELIVERY-FUNCTION">DELIVERY-FUNCTION</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The function that is used to deliver events.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE" class="xref">HANDLE</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF DELIVERY-FUNCTION)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20DELIVERY-FUNCTION%29">(SETF DELIVERY-FUNCTION)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:DEREGISTER-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ADEREGISTER-HANDLER">DEREGISTER-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLER</li>    <li class="argument">EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L8">Source</a>  </header> <div class="docstring"><pre>Deregister the given handler so that it no longer receives events from the event-loop.

Deregistering an unregistered handler will not cause an error.
Deregistering a handler might cause the event loop to be recompiled,
which can be a costly operation.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ARECOMPILE-EVENT-LOOP" class="xref">RECOMPILE-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:ENSURE-HANDLERS-SORTED"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AENSURE-HANDLERS-SORTED">ENSURE-HANDLERS-SORTED</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">SORTED-EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L11">Source</a>  </header> <div class="docstring"><pre>Ensures that the handlers are properly sorted on the event-loop

See <a href="#GENERIC-FUNCTION%20DEEDS%3ASORTED-HANDLERS" class="xref">SORTED-HANDLERS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ASORT-HANDLERS" class="xref">SORT-HANDLERS</a>
See <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">SORTED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-CONDITION-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-EVENT">EVENT-CONDITION-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The event that the event condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-CONDITION-EVENT)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-CONDITION-EVENT%29">(SETF EVENT-CONDITION-EVENT)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-CONDITION-SLOT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-SLOT">EVENT-CONDITION-SLOT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The slot that the event condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-CONDITION-SLOT)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-CONDITION-SLOT%29">(SETF EVENT-CONDITION-SLOT)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-CONDITION-VALUE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-VALUE">EVENT-CONDITION-VALUE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The value that the event condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-CONDITION-VALUE)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-CONDITION-VALUE%29">(SETF EVENT-CONDITION-VALUE)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-CONDITION-WRITERS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-CONDITION-WRITERS">EVENT-CONDITION-WRITERS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The writers that the event condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-CONDITION-WRITERS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-CONDITION-WRITERS%29">(SETF EVENT-CONDITION-WRITERS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP">EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-LOOP-CONDITION-EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-CONDITION-EVENT-LOOP">EVENT-LOOP-CONDITION-EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The event-loop that the event-loop condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-LOOP-CONDITION-EVENT-LOOP)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-LOOP-CONDITION-EVENT-LOOP%29">(SETF EVENT-LOOP-CONDITION-EVENT-LOOP)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-LOOP-CONDITION-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-CONDITION-HANDLER">EVENT-LOOP-CONDITION-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The handler that the event-loop condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-LOOP-CONDITION-HANDLER)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-LOOP-CONDITION-HANDLER%29">(SETF EVENT-LOOP-CONDITION-HANDLER)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-LOOP-LOCK"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-LOCK">EVENT-LOOP-LOCK</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>A lock used to synchronise access to the event-loop slots.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLERS" class="xref">HANDLERS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ASORTED-HANDLERS" class="xref">SORTED-HANDLERS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ADELIVERY-FUNCTION" class="xref">DELIVERY-FUNCTION</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-LOOP-LOCK)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-LOOP-LOCK%29">(SETF EVENT-LOOP-LOCK)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-SLOT-MUTABLE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-SLOT-MUTABLE">EVENT-SLOT-MUTABLE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Accessor to whether the given EVENT-SLOT is mutable or not.

See <a href="#CLASS%20DEEDS%3AEVENT-SLOT" class="xref">EVENT-SLOT</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF EVENT-SLOT-MUTABLE)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20EVENT-SLOT-MUTABLE%29">(SETF EVENT-SLOT-MUTABLE)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:EVENT-TYPE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-TYPE">EVENT-TYPE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The event-type that the handler accepts.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:FILTER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AFILTER">FILTER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The specification of a filter to figure out which events the handler accepts.

See <a href="#FUNCTION%20DEEDS%3ATEST-FILTER" class="xref">TEST-FILTER</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE">HANDLE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT</li>    <li class="argument">EVENT-DELIVERY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L6">Source</a>  </header> <div class="docstring"><pre>Directly handle the event by sending it to the handlers.

This function bypasses all threading, caching, ordering, and other
protective or optimisation constructs of the event delivery itself
and processes the event immediately. You should not call this function
on your own unless for when you are implementing an event-delivery on
your own. In that case you should call this function whenever you are
ready to actually process an event and send it out.

By default this simply calls the DELIVERY-FUNCTION of the
event-delivery with the given event.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE" class="xref">ISSUE</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLE-CANCELLED"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLE-CANCELLED">HANDLE-CANCELLED</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Accessor to whether the handler will handle events even if they are marked as being cancelled.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER">HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLER</li>    <li class="argument">EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L5">Source</a>  </header> <div class="docstring"><pre>Accesses the named handler from the event-loop, if such exists.

Handlers that do not have a NAME will be named by themselves.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF HANDLER)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20HANDLER%29">(SETF HANDLER)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLER</li>    <li class="argument">EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L6">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLER-CONDITION-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-CONDITION-HANDLER">HANDLER-CONDITION-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The handler that the handler condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF HANDLER-CONDITION-HANDLER)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20HANDLER-CONDITION-HANDLER%29">(SETF HANDLER-CONDITION-HANDLER)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLER-CONDITION-THREAD"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-CONDITION-THREAD">HANDLER-CONDITION-THREAD</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The thread that the handler condition is about.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF HANDLER-CONDITION-THREAD)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20HANDLER-CONDITION-THREAD%29">(SETF HANDLER-CONDITION-THREAD)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">CONDITION</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLER-LOCK"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLER-LOCK">HANDLER-LOCK</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Handler lock to lock the access to the internal threads list.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ATHREADS" class="xref">THREADS</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF HANDLER-LOCK)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20HANDLER-LOCK%29">(SETF HANDLER-LOCK)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:HANDLERS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AHANDLERS">HANDLERS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>An EQL hash-table of the registered handlers on the event-loop.
Be careful when modifying this table, as it is not synchronised.

See <a href="#GENERIC-FUNCTION%20DEEDS%3AEVENT-LOOP-LOCK" class="xref">EVENT-LOOP-LOCK</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF HANDLERS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20HANDLERS%29">(SETF HANDLERS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:IDENTIFIER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AIDENTIFIER">IDENTIFIER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The unique identifier of the group the event belongs to.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:INDEX"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AINDEX">INDEX</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The position of the event within the sequence.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:ISSUE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE">ISSUE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT</li>    <li class="argument">EVENT-DELIVERY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L5">Source</a>  </header> <div class="docstring"><pre>Issue an event to the delivery so that it is sent out to the handlers.

The exact point in time when the issued event is handled and processed
is not specified. However, the order in which events are handled must
be the same as the order in which they are issued. An event should only
ever be issued once. There is no check made to ensure this, but issuing
an event multiple times or on multiple deliveries leads to undefined
behaviour. There is also no check made to see whether the event delivery
is actually started and ready to accept events. If it is not started,
the events might pile up or be dropped on the floor. This is, 
essentially, undefined behaviour.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:ISSUE-TIME"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AISSUE-TIME">ISSUE-TIME</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The universal-time at which the event has been ISSUEd to an event-delivery.

See ISSUE.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF ISSUE-TIME)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20ISSUE-TIME%29">(SETF ISSUE-TIME)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:LOOPS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ALOOPS">LOOPS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Accessor to all the loops the handler is registered on right now.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF LOOPS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20LOOPS%29">(SETF LOOPS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:MAX-INDEX"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AMAX-INDEX">MAX-INDEX</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The maximum index of the sequence.

Might be NIL if the maximum length of the sequence is not yet known.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:MESSAGE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AMESSAGE">MESSAGE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The message of the message-event.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:NAME"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ANAME">NAME</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Returns a symbol describing the name of the object.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:ORIGIN"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AORIGIN">ORIGIN</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Some description of an origin from where the event was issued.

See <a href="#VARIABLE%20DEEDS%3A%2AORIGIN%2A" class="xref">*ORIGIN*</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ORIGIN" class="xref">WITH-ORIGIN</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:PAYLOAD"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3APAYLOAD">PAYLOAD</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The payload of to be delivered.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:RECOMPILE-EVENT-LOOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ARECOMPILE-EVENT-LOOP">RECOMPILE-EVENT-LOOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">COMPILED-EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L13">Source</a>  </header> <div class="docstring"><pre>Cause the event loop to be recompiled.

The event-loop's handlers must already be ready in their sorted
order before calling this function. This operation is potentially
very costly as it involves building a potentially very large
lambda and successively invoking COMPILE on it. With a large number
of registered handlers and a slow compiler, this might take up to
the order of seconds to run.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ABUILD-EVENT-LOOP" class="xref">BUILD-EVENT-LOOP</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AENSURE-HANDLERS-SORTED" class="xref">ENSURE-HANDLERS-SORTED</a>
See <a href="#CLASS%20DEEDS%3ACOMPILED-EVENT-LOOP" class="xref">COMPILED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:REGISTER-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3AREGISTER-HANDLER">REGISTER-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLER</li>    <li class="argument">EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L7">Source</a>  </header> <div class="docstring"><pre>Register the given handler so that it may receive events from the event-loop.

Registering the same handler twice will still result in it receiving
events only once, but will not cause an error. Registering a handler
might cause the event loop to be recompiled, which can be a costly
operation.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ARECOMPILE-EVENT-LOOP" class="xref">RECOMPILE-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:RESPONSE-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ARESPONSE-EVENT">RESPONSE-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Accessor to the response event the handler captures.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF RESPONSE-EVENT)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20RESPONSE-EVENT%29">(SETF RESPONSE-EVENT)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:RUNNING"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ARUNNING">RUNNING</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">STUFF</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>Returns T if the event delivery is able to process events. </pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:SORT-HANDLERS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ASORT-HANDLERS">SORT-HANDLERS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">HANDLERS</li>    <li class="argument">SORTED-EVENT-LOOP</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L10">Source</a>  </header> <div class="docstring"><pre>Sort the given list of handlers into the proper issuing sequence.

The returned list of handlers must be ordered in a way that the
BEFORE and AFTER lists of all handlers are met. If a dependency
cycle is detected, an error of type EVENT-LOOP-HANDLER-DEPENDENCY-CYCLE-ERROR
must be signalled.

See <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">SORTED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:SORTED-HANDLERS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ASORTED-HANDLERS">SORTED-HANDLERS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>A list of the registered handlers in their properly sorted order.

This function might become temporarily out of sync with HANDLERS.

See <a href="#GENERIC-FUNCTION%20DEEDS%3ASORT-HANDLERS" class="xref">SORT-HANDLERS</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AENSURE-HANDLERS-SORTED" class="xref">ENSURE-HANDLERS-SORTED</a>
See <a href="#CLASS%20DEEDS%3ASORTED-EVENT-LOOP" class="xref">SORTED-EVENT-LOOP</a></pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF SORTED-HANDLERS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20SORTED-HANDLERS%29">(SETF SORTED-HANDLERS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:START"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ASTART">START</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-DELIVERY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L3">Source</a>  </header> <div class="docstring"><pre>Start the event delivery and make it ready to accept and deliver events.

If the delivery is already running this does nothing.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:STOP"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ASTOP">STOP</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-DELIVERY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-delivery.lisp#L4">Source</a>  </header> <div class="docstring"><pre>Stop the event delivery to prevent it from accepting and delivering events.

If there are events that the handler has yet to process, there is no
guarantee that they will be processed before the event delivery is
stopped.

If the delivery is already stopped this does nothing.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:THREADS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3ATHREADS">THREADS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><pre>The threads of the parallel-handler.</pre></div> </article> </li>  <li> <article class="definition generic-function callable" id="GENERIC-FUNCTION DEEDS:(SETF THREADS)"> <header> <span class="visibility">EXTERNAL</span> <span class="type">GENERIC-FUNCTION</span> <h4 class="name"> <a href="#GENERIC-FUNCTION%20DEEDS%3A%28SETF%20THREADS%29">(SETF THREADS)</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NEW-VALUE</li>    <li class="argument">OBJECT</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:DEFINE-CACHED-SLOTS-CLASS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-CACHED-SLOTS-CLASS">DEFINE-CACHED-SLOTS-CLASS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NAME</li>    <li class="argument">DIRECT-SUPERCLASSES</li>    <li class="argument">DIRECT-SLOTS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>    <li class="argument">OPTIONS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/class-slots.lisp#L49">Source</a>  </header> <div class="docstring"><pre>Shorthand macro around defclass to define a cached-slots-class.

All this does is wrap the defclass in an EVAL-WHEN and add the
metaclass option for cached-slots-class.

See <a href="#CLASS%20DEEDS%3ACACHED-SLOTS-CLASS" class="xref">CACHED-SLOTS-CLASS</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:DEFINE-COMMAND"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-COMMAND">DEFINE-COMMAND</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NAME</li>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">OPTIONS-AND-BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/command.lisp#L6">Source</a>  </header> <div class="docstring"><pre>Define a command.

This is a combinging macro that does three things:
  . Define an event of NAME with the necessary fields from ARGS.
  . Define a function of NAME with the given ARGS that issues
    an instance of this newly defined event.
  . Define a handler of NAME on the NAME event with the given
    OPTIONS-AND-BODY.

A new option is available just for this macro with the name
:SUPERCLASSES, which allows you to specify the direct-superclasses
to use in the event definition.

The first argument in ARGS must be the name for the event as
required by DEFINE-HANDLER. The rest are arguments to the function
and simultaneously slots on the event class. In order to allow you
to specify slot options, arguments have the following structure:

ARGS       ::= SINGLE* [&amp;optional DEFAULTING*] [&amp;rest SINGLE*] [&amp;key DEFAULTING*]
SINGLE     ::= symbol | (symbol SLOT-ARG*)
DEFAULTING ::= symbol | (symbol value SLOT-ARG*)
SLOT-ARG   ::= keyword value

The purpose of defining commands is to allow something akin to a
function definition that can be treated as such for most purposes
while still integrating it with the event system and allowing
extension through that.</pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:DEFINE-EVENT"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-EVENT">DEFINE-EVENT</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">NAME</li>    <li class="argument">DIRECT-SUPERCLASSES</li>    <li class="argument">DIRECT-SLOTS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>    <li class="argument">OPTIONS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event.lisp#L20">Source</a>  </header> <div class="docstring"><pre>Shorthand convenience macro around DEFCLASS to define new event classes.

Pushes the EVENT-CLASS as :METACLASS and EVENT as direct-superclass
if it does not already appear somewhere as a transitive superclass.</pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:DEFINE-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3ADEFINE-HANDLER">DEFINE-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <ul class="arguments"> <li class="argument">NAME</li>  <li class="argument">EVENT-TYPE</li>  <li class="argument lambda-list-keyword">&amp;REST</li> </ul>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">OPTIONS-AND-BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L100">Source</a>  </header> <div class="docstring"><pre>Define and register a new event handler on a particular event loop.

This simply expands to a WITH-HANDLER form with a few extra options
to make things easier. Most notably, NAME is transformed (quoted) into
the :NAME option. If the :SELF option is given, it names the symbol
to which the instance of the handler itself is bound, from which it is
accessible from within the handler body.

See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-HANDLER" class="xref">WITH-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:DO-ISSUE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE">DO-ISSUE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-TYPE</li>    <li class="argument lambda-list-keyword">&amp;REST</li>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;KEY</li>    <li class="argument">LOOP</li>    <li class="argument lambda-list-keyword">&amp;ALLOW-OTHER-KEYS</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-loop.lisp#L125">Source</a>  </header> <div class="docstring"><pre>Shorthand macro to allow more convenient issuing of events.

Supports one extra keyword argument that will not be passed along
to the MAKE-INSTANCE call: LOOP will instead denote the event-loop
to which the event is issued, defaulting to *STANDARD-EVENT-LOOP*.

See <a href="#VARIABLE%20DEEDS%3A%2ASTANDARD-EVENT-LOOP%2A" class="xref">*STANDARD-EVENT-LOOP*</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:HERE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AHERE">HERE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments"></ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/origin.lisp#L9">Source</a>  </header> <div class="docstring"><pre>A macro that tries to figure out the most appropriate identifier for where this is.</pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-AWAITING"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-AWAITING">WITH-AWAITING</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">RESPONSE</li>    <ul class="arguments"> <li class="argument lambda-list-keyword">&amp;KEY</li>  <li class="argument">FILTER</li>  <li class="argument">TIMEOUT</li>  <li class="argument">LOOP</li>  <li class="argument lambda-list-keyword">&amp;REST</li> </ul>    <li class="argument">SETUP-FORM</li>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L144">Source</a>  </header> <div class="docstring"><i>No documentation provided.</i></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-FUZZY-SLOT-BINDINGS"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-FUZZY-SLOT-BINDINGS">WITH-FUZZY-SLOT-BINDINGS</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">VARS</li>    <ul class="arguments"> <li class="argument">INSTANCE</li>  <li class="argument">CLASS-ISH</li>  <li class="argument lambda-list-keyword">&amp;REST</li> </ul>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/toolkit.lisp#L34">Source</a>  </header> <div class="docstring"><pre>Establishes a binding context similar to WITH-SLOTS and WITH-ACCESSORS but using the most appropriate way to access a slot, and a fuzzy manner of identifying slots.

Each VAR can either be a list of NAME SLOT-ISH, or simply the SLOT-ISH which will be used as the name as well.

You must pass the class explicitly since we have to be able to analyse the slots of the class during compile time.

See <a href="#FUNCTION%20DEEDS%3ABUILD-FUZZY-SLOT-ACCESSOR" class="xref">BUILD-FUZZY-SLOT-ACCESSOR</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-HANDLER">WITH-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-TYPE</li>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">OPTIONS-AND-BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L86">Source</a>  </header> <div class="docstring"><pre>Convenient macro to construct a handler.

ARGS must be a list of at least one value, which must be a symbol that is
bound to the event instance. The rest of the args are slots of the event,
bound by WITH-FUZZY-SLOT-BINDINGS. Note that as per the limitation on
event-type specifiers arising from FIND-CLASS-SLOT-FOR-COMPOUND, only
direct class-name types or compound types consisting of OR and AND are
possible for the EVENT-TYPE.

The actual body forms are composed into a lambda form which is passed
as the :DELIVERY-FUNCTION argument to MAKE-HANDLER alongside with
EVENT-TYPE. It is also wrapped in a WITH-ORIGIN environment where the
origin is set to the :NAME option.

See <a href="#FUNCTION%20DEEDS%3AMAKE-HANDLER" class="xref">MAKE-HANDLER</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-FUZZY-SLOT-BINDINGS" class="xref">WITH-FUZZY-SLOT-BINDINGS</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ORIGIN" class="xref">WITH-ORIGIN</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-IMMUTABLE-SLOTS-UNLOCKED"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-IMMUTABLE-SLOTS-UNLOCKED">WITH-IMMUTABLE-SLOTS-UNLOCKED</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <ul class="arguments"></ul>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/event-class.lisp#L64">Source</a>  </header> <div class="docstring"><pre>Unlocks immutable slots, allowing you to modify them.

This simply automatically calls the CONTINUE restart when an error of type
IMMUTABLE-EVENT-SLOT-MODIFIED is signalled.

See <a href="#CLASS%20DEEDS%3AEVENT-SLOT" class="xref">EVENT-SLOT</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-ONE-TIME-HANDLER"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ONE-TIME-HANDLER">WITH-ONE-TIME-HANDLER</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">EVENT-TYPE</li>    <li class="argument">ARGS</li>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">OPTIONS-AND-BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L123">Source</a>  </header> <div class="docstring"><pre>Constructs a handler that can only handle a single event before being deregistered again.

Defaults the class to ONE-TIME-HANDLER.

See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-HANDLER" class="xref">WITH-HANDLER</a>
See <a href="#CLASS%20DEEDS%3AONE-TIME-HANDLER" class="xref">ONE-TIME-HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ADEREGISTER-HANDLER" class="xref">DEREGISTER-HANDLER</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-ORIGIN"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-ORIGIN">WITH-ORIGIN</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <ul class="arguments"> <li class="argument lambda-list-keyword">&amp;OPTIONAL</li>  <li class="argument">NEW-ORIGIN</li>  <li class="argument lambda-list-keyword">&amp;REST</li> </ul>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/origin.lisp#L5">Source</a>  </header> <div class="docstring"><pre>Binds *ORIGIN* to a new value, which is by default figured out by HERE.

See <a href="#VARIABLE%20DEEDS%3A%2AORIGIN%2A" class="xref">*ORIGIN*</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AHERE" class="xref">HERE</a></pre></div> </article> </li>  <li> <article class="definition macro callable" id="MACRO-FUNCTION DEEDS:WITH-RESPONSE"> <header> <span class="visibility">EXTERNAL</span> <span class="type">MACRO</span> <h4 class="name"> <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-RESPONSE">WITH-RESPONSE</a> </h4> <ul class="qualifiers"></ul> <ul class="arguments">  <li class="argument">ISSUE</li>    <li class="argument">RESPONSE</li>    <ul class="arguments"> <li class="argument lambda-list-keyword">&amp;KEY</li>  <li class="argument">FILTER</li>  <li class="argument">TIMEOUT</li>  <li class="argument">ISSUE-LOOP</li>  <li class="argument">RESPONSE-LOOP</li>  <li class="argument lambda-list-keyword">&amp;REST</li> </ul>    <li class="argument lambda-list-keyword">&amp;BODY</li>    <li class="argument">BODY</li>    <li class="argument lambda-list-keyword">&amp;REST</li>  </ul>  <a class="source-link" href="https://github.com/Shinmera/deeds/blob/8ee5b174a743e6aa86c1472590a2366e5ae2679d/handler.lisp#L173">Source</a>  </header> <div class="docstring"><pre>A macro to de-asynchronise waiting for a response to an event.

More specifically, this construct allows you to circumvent having to use
callbacks and instead allows the handling of an event that is in response
to an issued one in the same thread as if it all happened sequentially.

ISSUE ::= event-type | (event-type initarg*)
RESPONSE ::= event-type | (event-type [event-symbol slots*])

In detail the following happens when the block generated by this macro
is executed:
 . A handler is instantiated with the given response event-type and filter.
 . The handler is started up.
 . The handler's synchronizer lock is acquired.
 . The handler is registered on the given event-loop.
 . An event is issued with the event-type and initargs onto the event-loop.
 . Now the thread waits on the handler's condition variable.
 . Once the thread is reawakened before the timeout it binds the event
   from the handler and the specified slot variables, then proceeds to
   evaluate the body.
 . As a cleanup, the handler is deregistered and stopped.

The handler itself performs the following steps once it HANDLEs an event:
 . Acquire the one-time-handler exclusive lock.
 . Save the event on its own slot.
 . Acquire the synchronizer lock and immediately release it again to ensure
   that the issuing thread is waiting on the condition variable.
 . Notify the condition variable.

See <a href="#MACRO-FUNCTION%20DEEDS%3ADO-ISSUE" class="xref">DO-ISSUE</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3AREGISTER-HANDLER" class="xref">REGISTER-HANDLER</a>
See <a href="#GENERIC-FUNCTION%20DEEDS%3ADEREGISTER-HANDLER" class="xref">DEREGISTER-HANDLER</a>
See <a href="#MACRO-FUNCTION%20DEEDS%3AWITH-FUZZY-SLOT-BINDINGS" class="xref">WITH-FUZZY-SLOT-BINDINGS</a>
See <a href="#CLASS%20DEEDS%3ACONDITION-NOTIFY-HANDLER" class="xref">CONDITION-NOTIFY-HANDLER</a></pre></div> </article> </li> </ul> </article> </li> </ul> </section>  </article> <script>window.addEventListener("DOMContentLoaded", function(){
    var unmarkElement = function(el){
        if(el.tagName === "mark" || el.tagName === "MARK"){
            [].forEach.call(el.childNodes, function(child){
                el.parentNode.insertBefore(child, el);
            });
            el.parentNode.removeChild(el);
        }else if(el.parentNode.tagName === "mark"){
            return unmarkElement(el.parentNode);
        }
        return null;
    }

    var unmarkAll = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("mark"), unmarkElement);
    }
    
    var markElement = function(el){
        if(el.parentNode.tagName === "mark" || el.parentNode.tagName === "MARK"){
            return el.parentNode;
        } else {
            unmarkAll();
            var marked = document.createElement("mark");
            el.parentNode.insertBefore(marked, el);
            marked.appendChild(el);
            return marked;
        }
    }

    var markFragmented = function(){
        if(window.location.hash){
            var el = document.getElementById(decodeURIComponent(window.location.hash.substr(1)));
            if(el) markElement(el);
        }
    }

    var registerXrefLink = function(link){
        var el = document.getElementById(decodeURIComponent(link.getAttribute("href").substr(1)));
        if(el){
            link.addEventListener("click", function(){
                markElement(el);
            });
        }
    }

    var registerXrefLinks = function(root){
        root = root || document;
        [].forEach.call(root.querySelectorAll("a.xref"), registerXrefLink);
    }

    markFragmented();
    registerXrefLinks();
}); </script> </body> </html> 